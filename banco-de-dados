-- Criação do banco de dados
CREATE DATABASE IF NOT EXISTS sistema_academico
USE sistema_academico; -- Seleciona o banco de dados para uso

-- Tabela de usuários
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único do usuário
    nome VARCHAR(100) NOT NULL, -- Nome do usuário
    email VARCHAR(150) NOT NULL UNIQUE, -- E-mail único do usuário
    senha_hash VARCHAR(255) NOT NULL, -- Senha criptografada do usuário
    tipo ENUM('aluno', 'docente', 'admin') NOT NULL, -- Tipo de usuário
    ativo TINYINT(1) DEFAULT 1 -- Indica se o usuário está ativo (1) ou não (0)
);

-- Tabela de disciplinas
CREATE TABLE disciplinas (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único da disciplina
    nome VARCHAR(100) NOT NULL UNIQUE -- Nome da disciplina
);

-- Tabela de turmas
CREATE TABLE turmas (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único da turma
    disciplina_id INT NOT NULL, -- ID da disciplina da turma
    docente_id INT NOT NULL, -- ID do docente responsável pela turma
    FOREIGN KEY (disciplina_id) REFERENCES disciplinas(id), -- Chave estrangeira para disciplinas
    FOREIGN KEY (docente_id) REFERENCES usuarios(id) -- Chave estrangeira para usuários (docentes)
);

-- Tabela de matrículas
CREATE TABLE matriculas (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único da matrícula
    aluno_id INT NOT NULL, -- ID do aluno
    turma_id INT NOT NULL, -- ID da turma
    nota_final DECIMAL(3,2), -- Nota final do aluno na turma
    FOREIGN KEY (aluno_id) REFERENCES usuarios(id), -- Chave estrangeira para usuários (alunos)
    FOREIGN KEY (turma_id) REFERENCES turmas(id) -- Chave estrangeira para turmas
);

-- Tabela de avaliações
CREATE TABLE avaliacoes (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único da avaliação
    turma_id INT NOT NULL, -- ID da turma da avaliação
    nome VARCHAR(100) NOT NULL, -- Nome da avaliação
    peso DECIMAL(3,2) DEFAULT 0.00, -- Peso da avaliação na nota final
    FOREIGN KEY (turma_id) REFERENCES turmas(id) -- Chave estrangeira para turmas
);

-- Tabela de notas
CREATE TABLE notas (
    id INT AUTO_INCREMENT PRIMARY KEY, -- Identificador único da nota
    matricula_id INT NOT NULL, -- ID da matrícula
    avaliacao_id INT NOT NULL, -- ID da avaliação
    nota_obtida DECIMAL(3,2), -- Nota obtida pelo aluno
    FOREIGN KEY (matricula_id) REFERENCES matriculas(id), -- Chave estrangeira para matrículas
    FOREIGN KEY (avaliacao_id) REFERENCES avaliacoes(id) -- Chave estrangeira para avaliações
);

-- Inserção de usuários básicos (alunos e docentes)
INSERT INTO usuarios (nome, email, senha_hash, tipo) VALUES
('Aluno Exemplo', 'aluno@example.com', 'senha_hash_exemplo', 'aluno'),
('Docente Exemplo', 'docente@example.com', 'senha_hash_exemplo', 'docente');

-- Inserção de disciplinas
INSERT INTO disciplinas (nome) VALUES
('Matemática'),
('História'),
('Ciências');

-- Inserção de turmas
INSERT INTO turmas (disciplina_id, docente_id) VALUES
(1, 2), -- Turma de Matemática com Docente Exemplo
(2, 2); -- Turma de História com Docente Exemplo
